/**
 * Affdex v3.1
 */
function XHRWorker(e,t,o){var a=new XMLHttpRequest;a.addEventListener("load",function(){var e=new Worker(window.URL.createObjectURL(new Blob([this.responseText])));t&&t.call(o,e)},a),a.open("get",e,!0),a.setRequestHeader("Access-Control-Allow-Origin","*"),a.setRequestHeader("Access-Control-Allow-Headers","*"),a.send()}var affdex=affdex||{};affdex.version="3.1.201-2800e8c",affdex.getAffdexDotJsLocation=function(){for(var e=document.getElementsByTagName("script"),t=null,o=0;o<e.length;o++)e[o].src.match(/\/affdex\.js$/)&&(t=e[o].src.replace(/\/affdex\.js$/,"/"));return t},affdex.FaceDetectorMode={LARGE_FACES:0,SMALL_FACES:1},affdex.Detector=function(){var e=this;e.processFPS=30,e.worker=null,e.staticMode=!1,e.detectEmojis=!1,e.faceDetectorMode=affdex.FaceDetectorMode.LARGE_FACES,e.isWorkerInitialized=!1,e.isRunning=!1,e.callbacks={},e.detectExpressions={smile:!1,innerBrowRaise:!1,browRaise:!1,browFurrow:!1,noseWrinkle:!1,upperLipRaise:!1,lipCornerDepressor:!1,chinRaise:!1,lipPucker:!1,lipPress:!1,lipSuck:!1,mouthOpen:!1,smirk:!1,eyeClosure:!1,attention:!1,lidTighten:!1,jawDrop:!1,dimpler:!1,eyeWiden:!1,cheekRaise:!1,lipStretch:!1},e.detectAllExpressions=function(){o(e.detectExpressions,!0)},e.detectAppearance={gender:!1,glasses:!1,age:!1,ethnicity:!1},e.detectAllAppearance=function(){o(e.detectAppearance,!0)},e.detectEmotions={joy:!1,sadness:!1,disgust:!1,contempt:!1,anger:!1,fear:!1,surprise:!1,valence:!1,engagement:!1},e.detectAllEmotions=function(){o(e.detectEmotions,!0)},e.detectAllEmojis=function(){e.detectEmojis=!0},e.getCallback=function(t,o){var a=t+"Failure";return o&&(a=t+"Success"),e.callbacks[a]?e.callbacks[a]:function(){}};var t=function(e){var t=[];for(var o in e)e[o]&&t.push(o);return t},o=function(e,t){for(var o in e)e[o]=t},a=function(o){if(o)e.worker.postMessage({message:"start",metrics:{expressions:t(e.detectExpressions),emotions:t(e.detectEmotions),appearance:t(e.detectAppearance)},detectEmojis:e.detectEmojis,faceMode:e.faceDetectorMode,staticMode:e.staticMode,processFPS:e.processFPS});else{e.getCallback("onInitialize",o)("Failed to Initialize the worker")}};e.onWorkerMessage=function(t){if(t.data&&t.data.message){var o=t.data.message,n=t.data.status;switch(o){case"ready":a(n);break;case"started":e.onInitialize(n);break;case"stopped":e.onStopped(n);break;case"reset":e.getCallback("onReset",n)();break;case"results":e.onImageResults(n,t.data)}}},e.reset=function(){e.isWorkerInitialized?e.worker.postMessage({message:"reset"}):e.getCallback("onReset",!1)("Failed to reset the detector")},e.addEventListener=function(t,o){return e.callbacks[t]=o,e},e.removeEventListener=function(t){return delete e.callbacks[t],e},e.onStopped=function(t){t&&(e.worker.terminate(),e.worker=null,e.isWorkerInitialized=!1,e.isRunning=!1),e.getCallback("onStop",t)()}},affdex.Detector.prototype.start=function(){if(this.isRunning)this.getCallback("onInitialize",!1)("Failed to start the detector, it is already running");else{var e=affdex.getAffdexDotJsLocation();XHRWorker(e+"affdex-worker.js",function(t){this.worker=t,this.worker.onmessage=this.onWorkerMessage,this.worker.postMessage({message:"ctor",url:e}),this.isRunning=!0},this)}},affdex.Detector.prototype.onImageResults=function(e,t){e?this.getCallback("onImageResults",e)(t.faces,t.img,t.time):this.getCallback("onImageResults",e)(t.img,t.time,t.detail)},affdex.Detector.prototype.onInitialize=function(e){e&&(this.isWorkerInitialized=!0),this.getCallback("onInitialize",e)("Failed to Initialize the detectors")},affdex.Detector.prototype.stop=function(){this.isWorkerInitialized?this.worker.postMessage({message:"stop"}):this.getCallback("onStop",!1)("Failed to stop the detector, it is not running")},affdex.CameraDetector=function(e,t,o,a){var n=this;affdex.Detector.call(n);var i=null,r=t||640,s=o||480,c=(new Date).getTime()/1e3,l=e||document.createElement("div"),d=null,f=null,p="adapter-1.4.0.js";n.faceDetectorMode="undefined"==typeof a?affdex.FaceDetectorMode.LARGE_FACES:a;var u=function(){n.videoElement=document.createElement("video"),n.videoElement.id="face_video",n.videoElement.autoplay=!0,l.appendChild(n.videoElement),c=(new Date).getTime()/1e3,d=document.createElement("canvas"),d.id="face_video_canvas",d.width=r,d.height=s,d.style.display="none",l.appendChild(d),f=d.getContext("2d")},m=function(){n.videoElement&&n.videoElement.remove(),d&&d.remove(),n.videoElement=null,d=null},g=function(){if(n.isWorkerInitialized&&d){f.clearRect(0,0,d.width,d.height),f.drawImage(n.videoElement,0,0,r,s);k(f.getImageData(0,0,d.width,d.height),(new Date).getTime()/1e3-c)}};n.onWebcamReady=function(e){i=e,n.videoElement.addEventListener("canplay",function(){n.videoElement.play()});var t=function(){n.videoElement.removeEventListener("playing",n),affdex.Detector.prototype.start.apply(n)};n.videoElement.addEventListener("playing",t),n.videoElement.src=window.URL.createObjectURL(e),n.getCallback("onWebcamConnect",!0)()};var h=function(e,t,o,a){var n=document.createElement("script");n.type="text/javascript",n.src=t,n.onload=o,n.onerror=function(e){a("Error loading js file: "+t)},e.appendChild(n)},k=function(e,t){n.isWorkerInitialized&&n.worker.postMessage({message:"process",img:e,time:t})};n._startCamera=function(){navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(n.onWebcamReady).catch(n.getCallback("onWebcamConnect",!1))},n.start=function(){if(!n.isRunning){u();h(l,affdex.getAffdexDotJsLocation()+p,function(){n._startCamera()},function(){n.getCallback("onInitialize",!1)("Unable to load adaptor.js to load the camera")})}},n.onInitialize=function(e){affdex.Detector.prototype.onInitialize.call(n,e),e&&g()},n.onImageResults=function(e,t){g(),affdex.Detector.prototype.onImageResults.call(n,e,t)},n.stop=function(){if(i&&"undefined"!=typeof i.getTracks){i.getTracks().forEach(function(e,t,o){e.stop()})}m(),affdex.Detector.prototype.stop.call(n)}},affdex.FrameDetector=function(e){var t=this;affdex.Detector.call(t),t.faceDetectorMode="undefined"==typeof e?affdex.FaceDetectorMode.LARGE_FACES:e,t.start=function(){affdex.Detector.prototype.start.call(t)},t.onInitialize=function(e){affdex.Detector.prototype.onInitialize.call(t,e)},t.onImageResults=function(e,o){affdex.Detector.prototype.onImageResults.call(t,e,o)},t.stop=function(){affdex.Detector.prototype.stop.call(t)}},affdex.FrameDetector.prototype.process=function(e,t){this.isWorkerInitialized?this.worker.postMessage({message:"process",img:e,time:t}):this.getCallback("onImageResults",!1)(e,t,"the detector is not initialized")},affdex.PhotoDetector=function(e){var t=this;affdex.FrameDetector.call(t),t.staticMode=!0,t.faceDetectorMode="undefined"==typeof e?affdex.FaceDetectorMode.SMALL_FACES:e,t.process=function(e,o){affdex.FrameDetector.prototype.process.call(t,e,0)}};
